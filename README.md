# 🍉 西瓜时钟

简洁优雅的专注计时器，基于番茄工作法（Pomodoro Technique）。

**在线体验：** [clock.cosmelon.app](https://clock.cosmelon.app/)

## 功能

### 导航
- **三 Tab 导航** — 🍉专注 / 🏠瓜棚 / 🌱农场，顶栏 segmented control 切换
- **工具图标** — 🏆成就 + 📅历史 + ⚙️设置，任何 Tab 下可用
- 计时器运行中锁定 Tab 切换

### 核心
- **番茄工作法** — 专注 → 休息 → 专注 → 休息，简单循环
- **项目计时模式** — 规划多个子任务按顺序执行，记录预计 vs 实际时间
- **灵活时长** — 专注 1-120 分钟，休息 1-30 分钟可调
- **快速调时间** — idle 时点击计时器数字，快速切换常用时长（5/10/15/20/25/30/45/60min）
- **正计时/倒计时切换** — 计时中点击时钟数字，切换显示已过时间或剩余时间，偏好自动保存
- **无滚动条设计** — 隐藏页面滚动条，保留滚动功能，视觉更干净
- **鼠标拖拽滚动** — PC 端按住鼠标左键拖动即可滚动页面，带惯性效果，不影响按钮/输入框交互
- **智能鼓励文案** — 根据今日完成数量、与昨天对比、连续天数自动显示鼓励文案，中英文支持
- **周趋势图** — 历史面板顶部显示本周每天专注时长柱状图，今天高亮
- **最后冲刺提示** — 渐进式三级紧迫感：60s 呼吸闪烁 → 30s 加速 + glow → 10s 大幅脉冲
- **长按确认** — ✓/✗ 按钮需长按 1.5 秒确认，带环形进度动画，防止冲动操作
- **任务标记** — 为每个西瓜钟标记正在做的事，完成后可编辑
- **手动完成** — 跳过时按实际专注时间记录，给予对应生长阶段奖励
- **统一操作** — ✗ 退出、⏸ 暂停/继续、✓ 完成，两个模式一致
- **退出确认** — 番茄模式退出需确认，项目模式两步选择（重新开始/下一个/返回上一个）

### 项目计时模式 📋
- **创建项目** — 输入项目名称，添加多个子任务
- **子任务设置** — 每个子任务可设定名称、预计时间（分钟）、休息时间
- **自动推进** — 子任务按顺序执行：任务1 → 休息 → 任务2 → 休息 → ...
- **超时处理** — 超时后默认继续计时，进度环变红 + 数字显示 +MM:SS
- **任务名称** — 可选输入，不输入自动生成"专注 #N"
- **中途调整** — 执行中可跳过当前任务、插入新任务、删除未来任务
- **完成总结** — 预计 vs 实际时间对比，每个子任务时间条形图
- **中断恢复** — 关闭浏览器后重新打开，可恢复未完成项目
- **西瓜生长** — 子任务完成按实际时长计入西瓜生长系统

### 用户登录 🔐
- **邮箱验证码** — 输入邮箱，收到 6 位验证码，验证后登录
- **Google 登录** — 一键 OAuth 登录
- **Microsoft 登录** — 一键 OAuth 登录
- **自动刷新** — Access Token 过期前自动刷新，无感续期
- **主题适配** — 登录面板适配全部 5 套主题
- **个人资料编辑** — 点击头像上传新头像（Canvas 裁剪 256x256，R2 存储），点击昵称编辑修改
- **云端数据同步** — 登录后设置、专注记录、仓库数据自动同步，跨设备可用，本地优先

### 管理后台 🛠️
- **用户管理** — 查看所有用户列表，搜索邮箱/昵称，分页浏览
- **用户详情** — 查看用户基本信息 + 专注统计（总时长/次数/近 7 天）
- **禁用/启用** — 管理用户状态
- **权限控制** — 仅 role=admin 的用户可访问，JWT + D1 双重验证
- **独立部署** — admin.cosmelon.app，React 19 + Vite 7 + Tailwind CSS 4

### 西瓜生长系统
自定义 SVG 图标，根据专注时长显示不同生长阶段：
- 🌱 小芽（5-15min）→ 🌿 幼苗（16-25min）→ 🌼 小花（26-45min）→ 🍈 小瓜（46-60min）→ 🍉 大西瓜（61-90min）→ 👑 金西瓜（61-90min，10% 概率）
- <5 分钟不给收获物，>90 分钟封顶给大西瓜
- 金西瓜保底机制：连续 20 次 61-90min 未出 → 必出

### 仓库与合成
- **仓库系统** — 6 种收获物自动存入，Header 🎒 按钮进入
- **合成系统** — 4 条合成链路（20 种子→1 幼苗、15 幼苗→1 花、10 花→1 小瓜、5 小瓜→1 大西瓜）
- 金西瓜不可合成，只能通过 ≥90min 专注 + 概率获得
- 合成按钮 + "合成全部"，数量不足时置灰

### 成就徽章 🏆
- **44 个成就** — 5 个系列：⭐️坚持 / ⏱️专注 / 🏠瓜棚 / 🌱农场 / 🌟隐藏
- 顶栏🏆成就按钮，未查看新解锁红点提示
- 按系列分组展示，总进度条 + 系列进度条
- 徽章详情弹窗：名称、描述、解锁条件、进度条
- 解锁庆祝动画：灰色→彩色 + 光波 + 金色粒子
- 隐藏成就：未解锁显示"???"，解锁条件不可见
- 瓜棚系列：收获物收集、金西瓜、合成、切瓜、道具收集自动检测
- 农场系列：种植、收获、品种收集、外星人、瓜贼、连续活跃检测（预埋，等农场功能上线后生效）
- 隐藏系列完整：午夜完成、情人节、音效探索家、完美主义者、全能玩家、深夜园丁
- 云端同步：登录后成就数据自动同步，多设备合并

### 庆祝动画
- **分阶段庆祝系统** — 6 个生长阶段各有独立庆祝效果，递进感清晰
- 四层视觉结构：背景灯光 + 收获物光晕特写 + 粒子/礼花 + 随机鼓励文案
- 🌱 seed：暖光聚光灯 + 金色光点上升（2s）
- 🌿 sprout：绿色光柱 + 绿叶飘落（2.5s）
- 🌼 bloom：双侧射灯 + 花瓣纸屑 + 旋转光芒（3s）
- 🍈 green：多束射灯 + 彩色纸屑 + 礼花（3.5s）
- 🍉 ripe：全屏灯光秀 + 满屏礼花 + 随机特效（4s）
- ripe 随机特效池：礼花连发 / 纸屑暴风雨 / 小西瓜掉落 / 大西瓜滚入
- 每阶段 5 条随机鼓励文案（中英文）
- 点击任意位置可提前关闭

### 休息视觉差异
- 工作偏暖色调，休息偏冷色调（蓝/靛/紫）
- 进度环、按钮、标题、背景色全部跟随阶段切换
- 平滑 transition 过渡

### 自动化
- **自动开始休息**（默认开启）— 工作结束后自动进入休息倒计时
- **自动开始工作**（默认关闭）— 休息结束后自动开始下一个西瓜钟

### 音效系统
全部 Web Audio API 实时合成，零音频文件：

**25 种专注背景音**，支持多音效同时叠加（如"雨声 + 壁炉 + 棕噪音"）：
- 🌧️ 自然类（8 种）：雨声、雷雨、海浪、溪流、鸟鸣、风声、虫鸣、夜晚
- 🏠 环境类（7 种）：咖啡厅、壁炉、键盘敲击、图书馆、篝火、火车、水下
- 🎵 噪音类（5 种）：白噪音、粉噪音、棕噪音、双耳节拍、轻音乐
- 🐱 特色：猫咪呼噜
- 🕐 时钟类（8 种）：经典钟摆、轻柔滴答、机械钟表、木质钟声、老式座钟、怀表、电子节拍器、水滴计时

**10 种提醒音效**：和弦、铃声、自然、木琴、钢琴、电子、水滴、鸟鸣、马林巴、锣声

- 自定义混音器弹窗：每个音效独立开关 + 独立音量滑块
- 专注中修改背景音即时生效，无需暂停
- 提醒音效循环次数可调（1/2/3/5 次）
- 提醒音量和背景音量独立控制

### 主题
5 套主题，全局适配，WCAG AA 对比度达标：
- 🌑 经典暗色（西瓜化：绿底红进度环 + 西瓜红强调色）· ☀️ 纯净亮色 · 🌲 森林绿 · 🌊 海洋蓝 · 🔥 暖橙色
- Dark 主题进度环呈现"西瓜横截面"效果：深绿外皮底圈 + 西瓜红进度条

### 数据 & 历史
- **今日统计** — 完成数量 + 总专注时长
- **任务列表** — 可编辑、可删除（inline 确认，不误删）
- **历史记录** — 日历视图选择日期，查看任意一天的详细记录
- **有记录的日期**在日历上有圆点标记
- **导出数据** — 设置面板一键导出 JSON（记录 + 设置）
- **本地存储** — 数据保存在浏览器 localStorage，无需注册

### 统计图表
- **柱状图** — 最近 7 天 / 30 天专注时长趋势，纯 SVG 手绘
- **汇总数据** — 本周 / 本月 / 累计总时长 + 累计完成数量
- 图表配色跟随当前主题

### 连续打卡 🔥
- 全自动：当天完成 ≥1 个西瓜钟 = 已打卡
- 主页 header 显示当前连续天数
- 统计面板展示：当前连续天数 + 历史最长连续天数

### 多语言
- 🌐 8 种语言支持：中文、English、日本語、한국어、Español、Français、Deutsch、Português
- 自动检测浏览器语言，语言选择弹窗可手动切换
- 切换无需刷新，所有文案即时更新

### PWA
- 📱 可安装到手机/电脑桌面，standalone 模式运行
- 📶 离线可用（Service Worker 预缓存所有静态资源 + Google Fonts）
- 🍎 iOS Safari "添加到主屏幕"支持
- 友好的安装提示横幅（关闭后不再弹出）

### 桌面应用
- 🖥️ Tauri 2.x 打包，支持 Windows（.msi / .exe）和 Linux（.deb / .AppImage）
- 体积远小于 Electron（使用系统 WebView）
- GitHub Actions 自动构建 + 发布到 Releases

### 其他
- 设置面板 Alert Volume 滑块精致化：5px 纤细轨道、16px 小巧滑块、accent 发光交互反馈
- 健康提示改为仅在设置面板 Focus 时长下方条件显示（workMinutes > 25）
- 快捷选择器选 >25min 时弹出浮动 Toast 健康提醒（"专注时间较长，不会自动进入休息～记得到点给自己放个假哦 🧘"，不占布局空间，3.5s 自动消失，选回 ≤25min 立即消失）
- 设置菜单底部显示当前版本号（从 package.json 自动读取）
- 设置页四组分组标题（计时/提醒/外观/通用），清晰有序
- 8pt 间距网格系统，视觉层级分明
- 设置页触控目标 ≥ 44px，移动端友好
- 浏览器通知提醒
- 页面标题实时显示倒计时
- 新手引导弹窗
- 响应式布局，移动端友好

## 技术栈

- [React](https://react.dev/) 19 + [TypeScript](https://www.typescriptlang.org/)
- [Vite](https://vite.dev/) 7
- [Tailwind CSS](https://tailwindcss.com/) 4
- [Tauri](https://tauri.app/) 2.x — 桌面应用打包
- [vite-plugin-pwa](https://vite-pwa-org.netlify.app/) — Service Worker + Web App Manifest
- [Vercel](https://vercel.com/) — 部署
- **后端：** Cloudflare Workers（Hono）— API + Auth 独立服务 + D1 数据库

## 本地运行

```bash
# 安装依赖
npm install

# 启动开发服务器
npm run dev

# 构建生产版本
npm run build

# 预览生产版本
npm run preview
```

## 项目结构

```
src/
├── components/
│   ├── Timer.tsx              # 核心计时器（圆形进度环 + 控制按钮）
│   ├── CelebrationOverlay.tsx # 完成庆祝动画（粒子 + 弹跳图标）
│   ├── GrowthIcon.tsx         # 西瓜生长阶段 SVG 图标（6 阶段）
│   ├── HistoryPanel.tsx       # 历史记录 + 统计图表面板
│   ├── MiniCalendar.tsx       # 月历日期选择器
│   ├── BarChart.tsx           # 纯 SVG 柱状图
│   ├── AmbienceMixerModal.tsx # 背景音混音器弹窗
│   ├── AlertPickerModal.tsx   # 提醒音效选择弹窗
│   ├── ModeSwitch.tsx         # 番茄模式/项目模式切换
│   ├── ProjectSetup.tsx       # 项目创建 + 子任务编辑
│   ├── ProjectTaskBar.tsx     # 项目计时信息条（任务名 + 进度）
│   ├── ProjectSummary.tsx     # 项目完成总结
│   ├── ProjectRecoveryModal.tsx # 中断恢复弹窗
│   ├── ProjectMode.tsx        # 项目模式容器
│   ├── TaskInput.tsx          # 任务输入框
│   ├── TodayStats.tsx         # 今日完成统计
│   ├── TaskList.tsx           # 完成任务列表（编辑/删除）
│   ├── ConfirmModal.tsx         # 通用确认弹窗
│   ├── ProjectExitModal.tsx     # 项目退出两步弹窗
│   ├── Settings.tsx           # 设置面板（时长/音效/主题/导出）
│   ├── InstallPrompt.tsx      # PWA 安装提示横幅
│   └── Guide.tsx              # 新手引导弹窗
├── audio/
│   ├── context.ts             # 共享 AudioContext + 主音量控制
│   ├── mixer.ts               # 混音器状态管理（启停/音量/配置）
│   ├── ambience/sounds.ts     # 33 种背景音 AmbienceSound 子类
│   ├── alerts/sounds.ts       # 10 种提醒音效生成函数
│   └── index.ts               # 统一导出
├── hooks/
│   ├── useTimer.ts            # 番茄模式计时逻辑
│   ├── useProjectTimer.ts     # 项目计时逻辑
│   ├── useLocalStorage.ts     # localStorage 封装
│   └── useTheme.ts            # 主题上下文
├── i18n/
│   ├── types.ts               # 翻译类型定义
│   ├── locales/zh.ts          # 中文翻译
│   ├── locales/en.ts          # 英文翻译
│   └── index.ts               # i18n Context + useI18n hook
├── utils/
│   ├── time.ts                # 时间格式化
│   └── stats.ts               # 统计计算（打卡/分组/汇总）
├── types.ts                   # 类型定义 + 主题配色 + 生长阶段
├── App.tsx                    # 主应用
├── index.css                  # 全局样式 + 动画
└── main.tsx                   # 入口
api/                           # Cloudflare Workers — 业务 API
auth/                          # Cloudflare Workers — 认证服务
admin/                         # 管理后台（React SPA）
src-tauri/                     # Tauri 桌面应用（Rust）
```

## License

MIT

---

**Current version: v0.19.3**
