# ⏱️ 番茄时钟 — 设计文档 v2

> 版本：v2.1 | 日期：2026-02-14
> 所属系统：番茄时钟（专注工具）
> 关联文档：[系统总览](OVERVIEW-v2.md) · [瓜棚](SHED-DESIGN-v2.md) · [农场](FARM-DESIGN-v2.md)

## 定位

番茄时钟是整个西瓜宇宙的**起点**。用户在这里专注，获得收获物，为瓜棚和农场提供资源。

即使用户完全不玩瓜棚和农场，番茄时钟本身也是一个**完整好用的专注工具**。

---

## 一、核心计时

### 基本模式
- 番茄工作法：自定义专注/休息时长
- 简单循环：专注 → 休息 → 专注 → 休息（无长休息/轮次概念）
- 圆形进度环 SVG 计时器 + 渐变发光效果
- 统一按钮布局：✗ 退出（左）⏸/▶ 暂停/继续（中）✓ 完成（右）

### 项目模式
- 多个番茄钟的组合，适合大任务拆分
- 每个子任务独立计时，可设不同时长
- 退出需确认 → 选择（重新开始/下一个/返回上一个）

### 交互细节
- 退出需确认弹窗，记录标记为未完成
- 任务名称可选，不输入自动生成"专注 #N"（每天重置）
- 正计时/倒计时切换：计时中点击时钟数字可切换
- 自动休息默认开启，自动下一轮默认关闭

---

## 二、收获物系统

### 专注时长与收获物对应

| 收获物 | 专注时长 | 图标 | 说明 |
|--------|---------|------|------|
| 🌱 小芽 | 5-15 分钟 | 西瓜籽+小绿芽 | 碎片专注，热身阶段 |
| 🌿 幼苗 | 16-25 分钟 | 小绿苗+叶子 | 接近标准番茄钟 |
| 🌼 小花 | 26-45 分钟 | 藤蔓+黄色小花 | 标准番茄钟区间 |
| 🍈 小瓜 | 46-60 分钟 | 完整小西瓜 | 深度专注 |
| 🍉 大西瓜 | 61-90 分钟 | 完整大西瓜 | 长时间深度工作 |
| 👑 金西瓜 | 61-90 分钟（10%概率） | 金色西瓜 | 隐藏款，随机惊喜 |

### 规则
- < 5 分钟不给收获物
- > 90 分钟封顶为大西瓜，不触发金西瓜概率
- 收获物按**设定时间**计算，不按实际经过时间
- 金西瓜保底：连续 20 次 61-90 分钟未开出 → 第 21 次必出

### 收获物去向
所有收获物自动存入**瓜棚**（详见瓜棚设计文档）。

---

## 三、防挂机机制

### 规则 1：>25 分钟强制手动结束
- 设定 ≤25 分钟 → 时间到自动完成
- 设定 >25 分钟 → 必须手动点 Done
- 选择 >25 分钟时弹 Toast 提示："专注时间较长，不会自动进入休息～记得到点给自己放个假哦 🧘"

### 规则 2：超时 2 倍不给奖励
- 必须在设定时间的 2 倍以内点 Done 才有收获物
- 例：设了 30 分钟 → 必须在 60 分钟内点 Done
- 超过 → 没有收获物（视为挂机）

### 规则 3：奖励按设定时间算
- 防止"设短时间但拖着不点来刷更高奖励"

---

## 四、庆祝系统

每次专注完成后，播放全屏庆祝动画。

### 四层结构
1. **背景层：** 射灯/灯光效果
2. **中间层：** 收获物特写 + 金光/光晕
3. **前景层：** 礼花/粒子/飘落物
4. **底部：** 随机鼓励文案（中英文各 5 条/阶段）

### 分阶段递进

| 阶段 | 氛围 | 持续时间 | 粒子数 |
|------|------|---------|--------|
| 🌱 小芽 | 温暖柔和，希望之光 | 2.0s | 12 |
| 🌿 幼苗 | 生机勃勃，破土而出 | 2.5s | 20 |
| 🌼 小花 | 明亮喜悦，绽放时刻 | 3.0s | 30 |
| 🍈 小瓜 | 兴奋期待，丰收在望 | 3.5s | 40 |
| 🍉 大西瓜 | 狂欢震撼，盛大庆典 | 4.0s | 60+ |
| 👑 金西瓜 | 全屏金色爆炸 + 彩虹光效 | 8.0s | 100+ |

### 设计原则
- 越高阶越隆重，激励更长专注
- 不惩罚短专注，小芽也是温暖正面的
- 点击任意位置可提前关闭
- 纯 CSS 动画，不引入额外库

---

## 五、已实现功能清单（v0.16.0）

- ✅ 核心番茄钟（专注→休息无限循环）
- ✅ 项目模式（多任务组合）
- ✅ 25 种背景音 + 10 种提醒音效 + 自定义混音器
- ✅ 5 套主题（Dark/Light/Forest/Ocean/Warm）
- ✅ 8 种语言（中/英/日/韩/西/法/德/葡）
- ✅ 历史记录 + 统计
- ✅ 西瓜生长阶段图标（6 阶段含金西瓜）
- ✅ 庆祝系统（5 阶段递进 + 金西瓜特效）
- ✅ 收获物系统 + 防挂机
- ✅ 健康提醒 Toast
- ✅ 用户登录（邮箱验证码 + Google OAuth）
- ✅ 云端数据同步
- ✅ 管理后台
