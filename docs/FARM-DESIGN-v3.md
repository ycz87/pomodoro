# 🌱 农场系统 — 设计文档 v3

> 版本：v3.1 | 日期：2026-02-17
> 状态：Charles 确认
> 关联文档：[系统总览](OVERVIEW-v2.md) · [番茄时钟](POMODORO-DESIGN-v2.md) · [瓜棚](SHED-DESIGN-v2.md) · [星际商城](MARKET-DESIGN-v1.md) · [百科全书](ENCYCLOPEDIA-v1.md)

---

> 世界观、星系介绍、品种图鉴、道具图鉴、外星人图鉴详见 [百科全书](ENCYCLOPEDIA-v1.md)

## 产品结构

农场包含三个板块（tab 切换）：

| 板块 | 功能 |
|------|------|
| 🌾 瓜田 | 种植、生长、收获、使用道具 |
| 📖 图鉴 | 品种收藏、星系解锁、里程碑奖励 |
| 🧬 基因实验室 | 基因提取、融合、注入种子 |

> 星际商城作为独立模块，与番茄钟、瓜棚、农场并列，详见 [MARKET-DESIGN-v1.md](MARKET-DESIGN-v1.md)

---

# 板块一：🌾 瓜田

瓜田是农场的核心交互区。用户在这里种种子、看西瓜生长、使用道具、收获品种西瓜。

## 1.1 地块

**初始 4 块 → 最终 9 块**，双轨解锁（里程碑免费送 或 瓜币购买，取先到的）：

| 条件 | 地块数 | 或花钱买 |
|------|--------|---------|
| 默认 | 4 块 | — |
| 集齐 3 个品种 | 5 块 | 200 瓜币 |
| 集齐 5 个品种 | 6 块 | 500 瓜币 |
| 集齐 8 个品种（厚土星全收集） | 7 块 | 1000 瓜币 |
| 集齐 15 个品种 | 8 块 | 2000 瓜币 |
| 集齐 22 个品种 | 9 块（满） | 5000 瓜币 |

**地块状态：**
- 🟫 空地 — 可种植
- 🌱 生长中 — 显示当前阶段 + 进度条
- 🍉 已成熟 — 闪烁提示，可收获
- 💀 已枯萎 — 灰色，需手动清除

## 1.2 种植

从瓜棚背包选择种子 → 点击空地块 → 种下。

**种子类型：**

| 种子 | 来源 | 特点 |
|------|------|------|
| 🌰 神秘种子 | 切瓜获得 | 从已解锁星系品种池随机（初始只有厚土星，解锁越多池越大） |
| 🌰 注入种子 | 基因实验室注入 | 定向某星系（概率提升至 80%） |
| 🧬 杂交种子 | 基因实验室融合 | 双元素品种 |
| 🌈 幻彩种子 | 基因实验室五行融合 | 幻彩星品种 |

## 1.3 生长阶段

| 阶段 | 视觉 | 进度 |
|------|------|------|
| 🌰 种子期 | 土里的种子，微微隆起 | 0% |
| 🌱 发芽期 | 小芽破土（**此时揭晓品种**） | 20% |
| 🌿 长叶期 | 藤蔓伸展，叶子变多 | 50% |
| 🌼 开花期 | 小花绽放 | 75% |
| 🍉 结果期 | 西瓜长大，成熟可收获 | 100% |

> 品种在种下时已确定，发芽时 UI 揭晓。揭晓动画："叮！原来是 [品种名]！" 稀有品种有华丽特效。

## 1.4 生长周期

**核心机制：西瓜按真实时间生长，离线也在长，但需要用户定期回来。**

| 种子类型 | 成熟所需 | 不专注约 | 每天2h专注约 | 每天4h专注约 |
|---------|---------|---------|------------|------------|
| 五行纯种 | 10000 分钟 | 7 天 | 4 天 | 2 天 |
| 双元素杂交 | 20000 分钟 | 14 天 | 8 天 | 4 天 |
| 幻彩（五行融合）| 50000 分钟 | 35 天 | 19 天 | 10 天 |

**生长推进规则：**

每次用户打开 app，系统计算离线时长：

```
离线时长 = 本次打开时间 - 上次最后活动时间

如果 离线时长 ≤ 24小时：
  → 生长推进 = 离线的分钟数（离开多久长多久）

如果 24小时 < 离线时长 ≤ 72小时：
  → 生长推进 = 1440 分钟（24小时封顶）
  → 超出部分不算，但也不枯萎

如果 离线时长 > 72小时（3天）：
  → 纯种西瓜枯萎 💀
  → 杂交种子：枯萎阈值为 96 小时（4天）
  → 幻彩种子：不枯萎，只暂停。超过72小时停止生长，
    每超过24小时生长进度倒退5%（最多倒退到50%），回来后继续
```

## 1.5 专注加速

用户专注期间，西瓜生长速度额外加速。**只有专注的那段时间加速，不是乘整天。**

| 当天累计专注 | 加速倍率 | 效果 |
|------------|---------|------|
| ≤ 2 小时 | 10 倍 | 专注 1 分钟 = 西瓜额外多长 9 分钟 |
| > 2 小时部分 | 20 倍 | 专注 1 分钟 = 西瓜额外多长 19 分钟 |

**计算示例（纯种 10000 分钟）：**

每天只打卡不专注：
- 每天推进 1440 分钟 → 7 天成熟

每天专注 2 小时：
- 自然推进：1440 分钟
- 专注加速：120 分钟 × 10 倍 = 1200 分钟额外
- 每天总推进：2640 分钟 → 约 4 天成熟

每天专注 4 小时：
- 自然推进：1440 分钟
- 前 2 小时加速：120 × 10 = 1200 分钟额外
- 后 2 小时加速：120 × 20 = 2400 分钟额外
- 每天总推进：5040 分钟 → 约 2 天成熟

道具加速叠加在此基础上（如 ⚡星光肥料 +100%、🎵摇篮曲 +30%）。

## 1.6 收获

西瓜成熟后出现 ✋ 收获按钮，点击 → "摘瓜"动画（拽一下，啵的一声摘下来）→ 品种特写。

**收获获得三样东西：**
1. 📖 图鉴记录（永久，首次获得有华丽特效）
2. 🧬 该品种基因片段 ×1
3. 🍉 品种西瓜实体 ×1（可卖给商城或留着）

**首次收获奖励：** 每个新品种首次收获额外奖励等额瓜币（如翠纹瓜售价8瓜币，首次收获额外得8瓜币）。鼓励前期探索。

**超时未收：** 成熟后超过 2 天没收获 → 星际大盗 100% 来偷走。

## 1.7 枯萎

- 枯萎后显示 💀 灰色
- 需手动点击清除，腾出地块重新种
- 设计目的：让用户感受到"损失"，下次记得回来

## 1.8 道具使用

所有道具存放在瓜棚背包，在瓜田通过道具快捷栏使用。

> 道具完整列表（名字、价格、效果、来历）详见 [百科全书 · 道具图鉴](ENCYCLOPEDIA-v1.md#三道具图鉴)

**关键道具速查：**
- ⚡ 星露精华：单株加速 | ☀️ 超新星之瓶：全田加速
- 🪤 瓜瓜星人捕网：抓大盗 | 📡 星际追踪器：防偷追回 | 🎪 瓜农守护结界：全田免疫
- 🔦 变异射线枪：触发变异 | 🌙 月神甘露：稀有度+1 | 💧 琼浆玉露：复活枯萎

## 1.9 星际大盗机制

**出现概率（与当日专注挂钩）：**

| 当天行为 | 概率 |
|---------|------|
| 没打开 app | 15% |
| 打开没专注 | 5% |
| 专注 ≥25min | 2% |
| 专注 ≥60min | 0.5% |
| 成熟超 2 天没收 | 100% |

- 出现后倒计时 30 分钟偷瓜
- 🪤 瓜瓜星人捕网 → 抓住得奖励
- 🎪 瓜农守护结界 → 当天免疫
- 📡 星际追踪器 → 被偷后自动追回
- 被偷（无防护）→ 西瓜消失 + 星际大盗留"欠条"（趣味）
- **追回机制：** 被偷后 24 小时内专注 ≥25 分钟，可追回 50% 收获（基因片段保留，品种实体没了）

**设计目的：** "今天专注一下，西瓜就安全了"

## 1.10 变异系统

**核心理念：变异是中性的，有惊喜也有风险。**

**触发方式：**
- 自然变异：2% 基础概率（发芽期揭晓品种时判定）
- 🔦 变异射线枪：每使用一次，该株变异率 +20%，可累加至 100%（最多用 5 次 = 必定变异）

**变异结果（触发变异后三选一）：**

| 结果 | 概率 | 效果 |
|------|------|------|
| 🌟 良性变异 | 40% | 变成该品种的变异体（新图鉴条目，售价 3 倍） |
| 💀 恶性变异 | 30% | 西瓜得病，50% 概率枯萎死亡 |
| 😐 无效变异 | 30% | 变异失败，无变化，正常生长 |

**变异体：**
- 只有 ⭐⭐ 以上品种有变异体（约 45 个）
- 图鉴里单独标记，如"翠纹瓜·逆色"
- 基因片段跟原品种相同（不影响杂交系统）
- 售价是原品种的 3 倍

**用户决策：** 要不要对珍贵的瓜用变异射线枪？用了可能出稀有变异体（值钱+图鉴），也可能直接病死。越珍贵的瓜越不敢用，但变异体也越值钱——选择的代价。

## 1.11 天气 & 生命感

**天气（纯视觉）：** 每次打开随机 — ☀️晴天、☁️阴天、🌧️下雨、🌙星空、🌈彩虹（稀有）

**小动物（纯装饰）：** 偶尔出现 — 🐝蜜蜂、🦋蝴蝶、🐞瓢虫、🐦小鸟

## 1.12 外星人

> 外星人完整图鉴详见 [百科全书 · 外星人图鉴](ENCYCLOPEDIA-v1.md#四外星人图鉴)

三种外星人：👽 瓜瓜星人（友好）、🦹 星际大盗（偷瓜）、🧬 变异博士（亦正亦邪）。

---

# 板块二：📖 图鉴

图鉴是品种收藏中心，记录用户收获过的所有西瓜品种，追踪收集进度，解锁里程碑奖励。

## 2.1 图鉴结构

按星系分页展示，每个星系一个卡片区：

- 已解锁星系：展开显示所有品种格子
- 未解锁星系：显示锁定状态 + 解锁条件
- 已获得品种：品种图 + 名字 + 稀有度星标 + 首次获得日期
- 未获得品种：剪影 + "???" + 稀有度星标（让用户知道还有什么没拿到）

## 2.2 品种详情页

点击已获得品种 → 弹出详情：
- 品种名 + 星系 + 稀有度
- 一句话故事
- 首次获得日期
- 累计收获次数
- 当前持有数量（实体）
- 基因片段库存

## 2.3 星系解锁条件

| 星系 | 解锁条件 |
|------|---------|
| 🌍 厚土星（土） | 默认解锁 |
| 🔥 烈火星（火） | 集齐厚土星 5 个品种 |
| 💧 寒水星（水） | 集齐厚土星全部 8 个品种 |
| 🌿 青木星（木） | 集齐任意 2 个星系全部品种 |
| ✨ 玄金星（金） | 集齐任意 3 个星系全部品种 |
| 🌈 幻彩星 | 五行共鸣（五星系各≥1品种 + ≥3种双元素杂交品种） |
| 🌑 暗物质星 | 集齐幻彩星全部品种 |

> 解锁新星系时有过场动画："你的飞船发现了一颗燃烧的星球..."

## 2.4 品种列表

> 78 个品种的完整数据（名字、稀有度、掉率、售价、故事）详见 [百科全书 · 品种图鉴](ENCYCLOPEDIA-v1.md#二品种图鉴)

**品种总览：**
- 五行纯种：5 星系 × 8 品种 = 40 个（每星系 3⭐ + 2⭐⭐ + 2⭐⭐⭐ + 1⭐⭐⭐⭐）
- 幻彩星：5 个（2⭐⭐ + 2⭐⭐⭐ + 1⭐⭐⭐⭐）
- 暗物质星：3 个（1⭐⭐⭐ + 1⭐⭐⭐⭐ + 1👑）
- 双元素杂交：10 组合 × 3 品种 = 30 个（每组 ⭐60%/⭐⭐30%/⭐⭐⭐10%）
- 总计：78 个品种

## 2.5 进度追踪

图鉴首页显示"星际旅程"进度面板：
- 当前阶段："正在探索烈火星"
- 下一个里程碑："再集齐 3 个品种 → 解锁寒水星"
- 五行共鸣进度：厚土星 ✅ / 烈火星 2/8 / 寒水星 🔒 / 青木星 🔒 / 玄金星 🔒
- 暗物质星品种点击剪影 → 显示获取指引（如"需要：土火基因✅ 土水基因❌ ..."）

## 2.6 里程碑奖励

| 里程碑 | 奖励 |
|--------|------|
| 集齐 3 个品种 | 第 5 块地 |
| 集齐 5 个品种 | 解锁烈火星 |
| 集齐 8 个品种 | 第 7 块地 + 解锁寒水星 |
| 集齐任意 2 星系全部 | 解锁青木星 + 新专注主题 |
| 集齐任意 3 星系全部 | 解锁玄金星 + 第 8 块地 |
| 集齐 15 个品种 | 新背景音「宇宙白噪音」 |
| 五行共鸣达成 | 解锁幻彩星 + 五行融合功能 |
| 集齐 22 个品种 | 第 9 块地（满） |
| 集齐幻彩星全部 | 解锁暗物质星 |
| 集齐全部品种 | 「宇宙之心」+ 终极农场主题 |

---

# 板块三：🧬 基因实验室

基因实验室是杂交培育的核心。用户在这里提取基因、融合基因、注入种子，实现定向培育和跨星系杂交。

## 3.1 基因片段

**获取方式：** 每次在瓜田收获一个品种 → 自动获得该品种 1 份基因片段。

**基因属性：**
- 归属星系（🌍土 / 🔥火 / 💧水 / 🌿木 / ✨金）
- 来源品种（影响杂交成功率）
- 来源品种稀有度（⭐~⭐⭐⭐⭐）

同品种收获越多 → 基因片段越多。

## 3.2 三种操作

### 操作一：基因注入（定向种植）

把一个星系的基因片段注入到神秘种子里，让种子"偏向"该星系。

- 输入：1 颗神秘种子 + 1 份基因片段
- 输出：1 颗注入种子（该星系品种概率提升至 80%，剩余 20% 从其他已解锁星系随机）
- 用途：想要某个星系的品种但不想纯靠运气时使用
- 注意：注入种子不会出杂交品种，杂交只能通过杂交种子获得

### 操作二：双元素融合（杂交）

把两个不同星系的基因片段融合，产出杂交种子。

- 输入：2 份不同星系的基因片段
- 输出：1 颗双元素杂交种子（成功时）
- **有失败概率！**

**成功率取决于基因来源品种的稀有度：**

| 基因组合 | 成功率 |
|---------|--------|
| ⭐ × ⭐ | 30% |
| ⭐ × ⭐⭐ | 45% |
| ⭐⭐ × ⭐⭐ | 55% |
| ⭐⭐⭐ × 任意 | 70% |
| ⭐⭐⭐⭐ × 任意 | 90% |

- 失败：基因消耗，不产出种子
- 🧬 基因改造液道具：成功率 +20%

**用户决策：** 用普通瓜基因多试几次碰运气？还是攒稀有瓜基因一次成功？

### 操作三：五行融合（幻彩种子）

基因实验室的特殊操作，解锁后出现"五行融合"按钮，一键完成。

- 前提：五行共鸣达成后解锁（五星系各≥1品种 + ≥3种双元素杂交品种）
- 操作：点击"五行融合"按钮 → 系统自动消耗五种基因各 1 份
- 输出：1 颗幻彩种子（成功时）
- 成功率：50%（基础），使用的基因稀有度越高越容易成功
- 失败：消耗 4 份基因，随机返还 1 份（降低失败痛感）
- 用户不需要手动选5个基因拼合，一键操作

**幻彩品种保底：** 同一幻彩品种最多重复 3 次后，下一颗必出未获得的新品种。最多 8 颗幻彩种子即可集齐全部 5 个品种。

## 3.3 暗物质星种子获取

暗物质星品种不通过常规杂交获得：

| 品种 | 获取方式 |
|------|---------|
| 虚空瓜 | 用 5 颗不同幻彩品种的基因融合 |
| 黑洞瓜 | 用全部 10 种双元素基因同时融合 |
| 宇宙之心 | 集齐所有品种后自动出现（彩蛋） |

---

# 经济循环总览

```
⏱️ 专注
  ↓ 收获物（原材料，不可卖）
🏠 瓜棚（合成 → 切瓜）
  ↓ 神秘种子 + 道具
🌾 瓜田（种植 → 生长 → 收获）
  ↓ 品种西瓜（成品）+ 基因片段
  ├→ 📖 图鉴（收藏 + 里程碑奖励）
  ├→ 🧬 基因实验室（融合 → 杂交/幻彩种子 → 回到瓜田）
  └→ 🏪 星际商城（卖瓜 → 💰瓜币 → 买道具/种子）
```

> 星际商城详细设计见 [MARKET-DESIGN-v1.md](MARKET-DESIGN-v1.md)

---

# 设计原则

1. **专注是核心** — 所有系统都指向"让用户更想专注"
2. **每天回来** — 活跃天数 + 枯萎机制鼓励每天打开
3. **专注 = 安全** — 专注越多，星际大盗越不敢来
4. **两条路径** — 开盲盒（运气）+ 杂交培育（策略）
5. **选择的代价** — 卖瓜 vs 留基因，普通瓜试错 vs 稀有瓜保成功
6. **收集欲** — 78 个品种 + 星系解锁 + 图鉴剪影
7. **经济闭环** — 卖瓜→买道具→更好地种瓜
8. **简洁操作** — 种一下、摘一下、融合一下
9. **有生命感** — 天气、小动物、外星人

---

# 开发计划

| Phase | 内容 | 预估 |
|-------|------|------|
| Phase 1 ✅ | 瓜田 MVP（4 地块 + 种植 + 生长 + 收获 + 厚土星 8 品种） | 已完成 |
| Phase 2 | 五行星系 + 基因实验室 + 杂交 | 待排期 |
| Phase 3 | 星际商城 + 瓜币经济 | 待排期 |
| Phase 4 | 幻彩星 + 暗物质星 | 待排期 |
| Phase 5 | 星际大盗 + 天气 + 外星人 + 生命感 | 待排期 |
