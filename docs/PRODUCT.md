# 🍉 西瓜时钟 — 产品文档

## 项目信息

- **产品名称：** 西瓜时钟（Watermelon Clock）
- **线上地址：** https://watermelon-clock.pages.dev/
- **旧地址：** https://pomodoro-puce-seven-98.vercel.app/
- **GitHub：** https://github.com/ycz87/pomodoro
- **技术栈：** React 19 + Vite 7 + Tailwind CSS 4 + TypeScript
- **后端：** Cloudflare Workers（Hono）— API（watermelon-clock-api）+ Auth（cosmelon-auth）+ D1 数据库
- **部署：** Cloudflare Pages（前端）+ Cloudflare Workers（API + Auth）
- **域名：** clock.cosmelon.app（前端）、api.clock.cosmelon.app（业务 API）、auth.cosmelon.app（认证服务）、admin.cosmelon.app（管理后台）
- **CI/CD：** GitHub Actions（push main 自动部署）

## 产品定位

基于番茄工作法的专注计时工具，以西瓜生长为主题，简洁好用，有成就感。

## 当前功能概览

### 导航结构
- **顶栏三 Tab**：🍉专注 / 🏠瓜棚 / 🌱农场，iOS segmented control 风格
- **右侧工具图标**：🏆成就（带红点）→ 📅历史 → ⚙️设置
- 计时器运行中禁止切换 Tab
- 番茄钟/项目模式切换（ModeSwitch）在专注 Tab 内时钟区域上方

### 核心计时
- 番茄工作法：自定义专注/休息时长
- 圆形进度环 SVG 计时器 + 渐变发光效果
- 简单循环：专注 → 休息 → 专注 → 休息（无长休息/轮次概念）
- 统一按钮布局：✗ 退出（左）⏸/▶ 暂停/继续（中）✓ 完成（右）
- 退出需确认，记录标记为未完成
- 任务名称可选，不输入自动生成"专注 #N"
- **正计时/倒计时切换**：计时中点击时钟数字可切换显示模式，偏好自动保存
- **无滚动条设计**：隐藏页面滚动条，保留滚动功能，视觉更干净
- **鼠标拖拽滚动**：PC 端按住鼠标左键拖动即可滚动页面，带惯性效果
- **智能鼓励文案**：根据今日完成数量、与昨天对比、连续天数自动显示鼓励文案
- **周趋势图**：历史面板顶部显示本周每天专注时长柱状图
- **最后冲刺提示**：渐进式三级紧迫感（60s 呼吸 → 30s 加速 → 10s 脉冲），glow + 动画递增
- **长按确认**：✓/✗ 按钮需长按 1.5 秒确认，防止冲动操作

### 用户登录
- 邮箱验证码登录：输入邮箱 → 收到 6 位验证码 → 验证登录
- Google OAuth 一键登录
- Microsoft OAuth 一键登录
- JWT 认证：Access Token 15 分钟自动刷新，Refresh Token 30 天
- 设置页顶部显示用户信息或登录入口
- 底部滑出登录面板，精致动画，全主题适配
- **个人资料编辑**：点击头像上传新头像（Canvas 裁剪 256x256，R2 存储），点击昵称编辑修改

### 云端数据同步
- 登录后自动同步：设置、专注记录、仓库数据跨设备可用
- 本地优先策略：先写 localStorage，异步推云端，离线可用
- 首次登录自动迁移本地数据到云端
- 未登录用户不受影响，继续使用 localStorage

### 管理后台（admin.cosmelon.app）
- 邮箱验证码登录（复用 auth 服务），仅 role=admin 可访问
- 用户列表：分页、搜索（邮箱/昵称）、头像/昵称/邮箱/登录方式/状态/注册时间
- 用户详情：基本信息 + 专注统计（总时长/总次数/近 7 天）
- 用户管理：禁用/启用用户

### 项目计时模式
- 创建项目，添加多个子任务（名称 + 预计时间 + 休息时间）
- 子任务按顺序自动推进，中间自动休息
- 超时默认继续计时（进度环变红 + 数字显示 +MM:SS）
- ✓ 完成 / ✗ 退出按钮，快速操作当前子任务
- 退出当前任务后可选择：重新开始 / 下一个任务 / 返回上一个任务
- 退出整个项目选项
- 执行中可插入新任务、删除未来任务
- 完成总结：预计 vs 实际时间对比 + 每个子任务条形图
- 中断恢复：关闭后重新打开可恢复进度
- 子任务完成计入西瓜生长系统和今日统计

### 音效系统（全部 Web Audio API 合成，零音频文件）
- **25 种背景音**，支持多音效同时叠加：
  - 🌧️ 自然类（8 种）：雨声、雷雨、海浪、溪流、鸟鸣、风声、虫鸣、夜晚
  - 🏠 环境类（7 种）：咖啡厅、壁炉、键盘敲击、图书馆、篝火、火车、水下
  - 🎵 噪音类（5 种）：白噪音、粉噪音、棕噪音、双耳节拍、轻音乐
  - 🐱 特色：猫咪呼噜
- **8 种时钟音效**：经典钟摆、轻柔滴答、机械钟表、木质钟声、老式座钟、怀表、电子节拍器、水滴计时
- **10 种提醒音效**：和弦、铃声、自然、木琴、钢琴、电子、水滴、鸟鸣、马林巴、锣声
- 混音器弹窗：每个音效独立开关 + 独立音量
- 专注中修改背景音即时生效

### 视觉 & 主题
- 5 套主题：暗色、亮色、森林、海洋、暖橙
- **Dark 主题西瓜化**：进度环绿底红进度（西瓜皮 + 西瓜瓤），主强调色西瓜红 #FF3B5C
- Focus 标签胶囊带西瓜绿底色，Break 保持暖色调
- 西瓜生长阶段系统（5 级 SVG 图标）
- **分阶段庆祝系统**：5+1 个阶段各有独立庆祝效果（射灯+光晕+粒子+文案），从 seed 温暖希望到 legendary 金色爆炸递进
- 完成时庆祝动画（四层结构：背景灯光 + 光晕特写 + 粒子礼花 + 随机鼓励文案）
- ripe 阶段随机特效池（礼花连发/纸屑暴风雨/小西瓜掉落/大西瓜滚入）
- 工作/休息阶段视觉差异化
- **西瓜主题鼓励语**：中英文全部替换为西瓜主题文案，随机轮换

### 统计 & 记录
- 今日完成统计 + 任务记录列表
- 月历视图 + 日期详情
- 柱状图趋势（7/30 天）
- 连续打卡（🔥 streak）
- 数据导出（JSON）

### 成就徽章系统 🏆
- 44 个成就，5 个系列：⭐️坚持（10）/ ⏱️专注（10）/ 🏠瓜棚（10）/ 🌱农场（8）/ 🌟隐藏（6）
- 顶栏🏆成就按钮，未查看新解锁红点提示
- 成就页面：按系列分组展示，总进度条 + 系列进度条
- 徽章展示：未解锁灰色 + 🔒，已解锁系列主色调 + 微光效果
- 隐藏系列未解锁显示"???"
- 点击徽章查看详情弹窗（名称、描述、解锁条件、进度条、解锁时间）
- 解锁检测：坚持系列（连续打卡、累计天数、早起鸟、夜猫子、周末战士、周年）+ 专注系列（累计时长、单次深度、日强度、项目完成数）
- 隐藏成就检测（午夜完成、情人节、完美主义者、音效探索家、全能玩家、深夜园丁）
- 瓜棚系列检测（收获物收集、金西瓜、合成次数、切瓜、道具收集）
- 农场系列检测逻辑预埋（种植、收获、品种收集、外星人、瓜贼、连续活跃），等农场功能上线后自动生效
- 解锁庆祝弹窗：灰色→彩色动画 + 光波扩散 + 金色粒子，多个依次展示
- localStorage 持久化，中英文双语支持
- 云端同步：成就数据随登录自动同步，多设备合并（取解锁并集，时间取较早的）

### 仓库与合成
- **仓库系统**：6 种收获物（种子/幼苗/花/小瓜/大西瓜/金西瓜）自动存入
- **合成系统**：4 条合成链路（20 种子→1 幼苗、15 幼苗→1 花、10 花→1 小瓜、5 小瓜→1 大西瓜）
- **金西瓜**：≥90min 专注 10% 概率触发，保底 20 次必出，不可合成
- **仓库页面**：收获物展示 + 数量 + 合成操作 + 统计
- 金西瓜未获得时显示 🔒 + "???"

### 防挂机
- **Overtime 模式**：>25 分钟专注到时后进入正计时，需手动点 Done
- **2x 超时惩罚**：实际时间超过设定 2 倍 → 不给收获物
- **健康提示**：仅在设置面板 Focus 时长区域显示，且仅在 >25 分钟时出现
- **健康提醒 Toast**：快捷选择器选 >25min 时弹出浮动 Toast（"专注时间较长，不会自动进入休息～记得到点给自己放个假哦 🧘"，不占布局空间，3.5s 自动消失，选回 ≤25min 立即消失，适配全主题）

### 多端支持
- PWA：可安装到手机/桌面，离线可用
- Tauri 桌面应用：Windows + Linux
- 中英文双语，自动检测浏览器语言
- **8 种语言支持**：中文、English、日本語、한국어、Español、Français、Deutsch、Português（巴西）
- 语言选择弹窗：国旗 + 语言原名，当前选中高亮

## 版本路线图

| 版本 | 状态 | 内容 |
|------|------|------|
| v0.01 | ✅ 完成 | MVP — 核心计时、任务记录、今日统计 |
| v0.02 | ✅ 完成 | 视觉升级 — 渐变进度环、现代按钮、光晕效果 |
| v0.03 | ✅ 完成 | 体验完善 — 自定义时长、长休息、音效、主题、PWA |
| v0.04 | ✅ 完成 | 历史记录 + 统计图表 + 连续打卡 |
| v0.05 | ✅ 完成 | 多语言支持（中英文） |
| v0.1 | ✅ 完成 | Tauri 桌面应用打包 + GitHub Actions 自动构建 |
| v0.2 | ✅ 完成 | 音效系统大改版 — 自定义混音器（15 种背景音叠加）+ 提醒音效升级（10 种 + 循环播放） |
| v0.2.3 | ✅ 完成 | 4 项 Bug 修复 + 6 种新背景音（总计 25 种）+ 咖啡厅音效重做 |
| v0.2.4 | ✅ 完成 | 专注中修改背景音即时生效 + 4 种新时钟音效（总计 8 种） |
| v0.3 | ✅ 完成 | 项目计时模式 — 多子任务顺序执行、预计 vs 实际对比、中断恢复 |
| v0.3.1 | ✅ 完成 | 项目模式交互优化 — 超时默认继续、统一按钮布局 |
| v0.4 | ✅ 完成 | 交互重构 — 去掉长休息/轮次、退出确认、两步退出、默认任务名 |
| v0.4.2 | ✅ 完成 | UI 系统性改版 — Header 重构、计时数字提权、设置页分组、8pt 间距网格 |
| v0.4.3 | ✅ 完成 | UI 打磨第二轮 — 按钮降权、输入框对比度、底部空白、触控目标 |
| v0.4.4 | ✅ 完成 | 全主题对比度修复 — WCAG AA 标准、新增 border token、亮色主题兼容 |
| v0.4.5 | ✅ 完成 | Bug 修复 — 项目模式跳过任务、进度显示、break 跳过、skip 自动开始、abandoned 记录 |
| v0.4.6 | ✅ 完成 | Bug 修复 — 退出弹窗文案一致性、break/✓ 互斥、亮色主题对比度、i18n 即时刷新、移动端按钮热区 |
| v0.4.7 | ✅ 完成 | Logo 替换 + 品牌文字 — 矢量 SVG 新 Logo、Header 品牌名称、全套图标重新生成 |
| v0.4.8 | ✅ 完成 | 多项修复 + 新功能 — useTimer guard 恢复、PNG Logo、提醒音持续循环、项目模式 3 bug 修复、abandoned callback 延迟 |
| v0.4.9 | ✅ 完成 | Bug 修复 — 返回上一个任务记录累加修复（previousSeconds 机制）、休息进度环 totalDuration 修复 |
| v0.5 | ✅ 完成 | 智能鼓励文案 + 正计时/倒计时切换 + 无滚动条设计 + 鼠标拖拽滚动 |
| v0.6 | ✅ 完成 | 周趋势图 + 最后冲刺提示 + 长按确认 |
| v0.7.0 | ✅ 完成 | 品牌视觉升级 — Dark 主题西瓜化（绿底红进度环）、西瓜红强调色、西瓜主题鼓励语 |
| v0.7.1 | ✅ 完成 | 庆祝系统升级 — 5 阶段分级庆祝（射灯+光晕+粒子+文案递进）、ripe 随机特效池 |
| v0.8.0 | ✅ 完成 | 仓库与合成系统 — 6 阶段收获物（含金西瓜）、仓库页面、4 条合成链路、保底机制 |
| v0.8.1 | ✅ 完成 | 阈值调整 + 防挂机 — 新阈值 5-15/16-25/26-45/46-60/61-90、overtime 模式、2x 超时惩罚 |
| v0.8.3 | ✅ 完成 | Alert Volume 滑块视觉升级 — 轨道加粗到 8px、滑块放大到 22px、accent 发光描边、未填充轨道对比度提升 |
| v0.8.8 | ✅ 完成 | 小瓜和大西瓜图标优化 — 小瓜改为完整迷你西瓜 SVG，大西瓜改为完整大西瓜 SVG（未切开），风格统一 |
| v0.8.7 | ✅ 完成 | 音量滑块尺寸缩小 — 轨道 8px→5px、滑块 22px→16px、描边/发光等比例缩小，更精致不突兀 |
| v0.8.2 | ✅ 完成 | autoStartBreak UI 联动 — >25min 自动关闭并灰掉开关、提示文案移到设置面板 |
| v0.8.9 | ✅ 完成 | 提示展示策略优化 — 移除主页常驻提示，改为设置面板 workMinutes > 25 条件显示 tip |
| v0.9.0 | ✅ 完成 | 健康提醒 Toast — 快捷选择器选 >25min 弹出 Toast 提醒，fade 动画，3.5s 消失，适配全主题 |
| v0.9.1 | ✅ 完成 | Toast 体验修复 — 浮动定位不占布局空间、选回 ≤25min 立即消失 |
| v0.9.2 | ✅ 完成 | Toast 健康提醒文案优化 — 中英文文案改为关怀式语气，更自然亲切 |
| v0.10.0 | ✅ 完成 | Workers API 骨架 + GitHub Actions 自动部署 |
| v0.11.0 | ✅ 完成 | 用户登录系统 — 邮箱验证码 + Google/Microsoft OAuth + JWT 认证 |
| v0.12.0 | ✅ 完成 | Auth 服务拆分 — 认证服务独立 Workers + 自定义域名支持 |
| v0.13.0 | ✅ 完成 | 个人资料编辑 — 头像上传（R2 存储）+ 昵称修改 |
| v0.14.0 | ✅ 完成 | 云端数据同步 — 设置/记录/仓库跨设备同步 |
| v0.15.0 | ✅ 完成 | 管理后台 — 用户列表/搜索/详情/禁用启用 |
| v0.16.0 | ✅ 完成 | 多语言扩展 — 8 种语言 + 语言选择弹窗 |
| v0.8 | ⏳ 计划 | 切瓜（待定） |
| v0.9 | ⏳ 计划 | Chrome 扩展等多端覆盖 |
| v1.0 | ⏳ 计划 | 账号体系（注册登录、多设备同步） |

## 推广计划

- 先打磨到自己满意 → 小范围测试 → 集中推广
- 渠道：Product Hunt、V2EX、少数派、即刻、Reddit、Hacker News
- SEO + 内容营销
