# 🏠 瓜棚 — 设计文档 v2

> 版本：v2.1 | 日期：2026-02-14
> 所属系统：瓜棚（仓库与工坊）
> 关联文档：[系统总览](OVERVIEW-v2.md) · [番茄时钟](POMODORO-DESIGN-v2.md) · [农场](FARM-DESIGN-v2.md)

## 定位

瓜棚是玩家的**资源中心**——仓库 + 工坊。

所有专注产出（收获物）和切瓜产出（种子、道具）都存放在这里。瓜棚是连接「番茄时钟」和「农场」的桥梁：收获物在这里合成大西瓜，大西瓜在这里切开变成种子，种子从这里带去农场。

---

## 一、瓜棚存储

瓜棚里存放三类物品：

### 1. 收获物（来自专注）
| 收获物 | 图标 | 来源 |
|--------|------|------|
| 小芽 | 🌱 | 专注 5-15 分钟 |
| 幼苗 | 🌿 | 专注 16-25 分钟 |
| 小花 | 🌼 | 专注 26-45 分钟 |
| 小瓜 | 🍈 | 专注 46-60 分钟 |
| 大西瓜 | 🍉 | 专注 61-90 分钟 / 合成 |
| 金西瓜 | 👑 | 专注 61-90 分钟（10%概率） |

### 2. 神秘种子（来自切瓜）
- 切开大西瓜/金西瓜后获得
- 外观统一为「🌰 神秘种子」，品种未知
- 带去农场种下后才揭晓品种

### 3. 道具（来自切瓜）
- 切瓜时偶尔蹦出
- **只在农场中使用**（详见农场设计文档）

---

## 二、合成系统

低阶收获物可以合成高阶收获物。

### 合成链路

| 合成方向 | 所需数量 | 产出 |
|---------|---------|------|
| 🌱 小芽 → 🌿 幼苗 | 20 个小芽 | 1 个幼苗 |
| 🌿 幼苗 → 🌼 小花 | 15 个幼苗 | 1 朵小花 |
| 🌼 小花 → 🍈 小瓜 | 10 朵小花 | 1 个小瓜 |
| 🍈 小瓜 → 🍉 大西瓜 | 5 个小瓜 | 1 个大西瓜 |

### 合成规则
- 合成代价约为直接专注的 3-5 倍，**故意不划算**，鼓励更长专注
- 金西瓜 👑 **不可合成**，只能靠运气
- 合成只能手动触发
- 支持"合成 1 个"和"合成全部"

### 合成的意义
合成是**保底机制**，不是主要路径。即使用户每次只能专注 5 分钟，攒够小芽也能一步步合成出大西瓜来切。

---

## 三、切瓜系统

**这是瓜棚最核心的玩法——把大西瓜切开，获得神秘种子和道具。**

### 可切的瓜
- 🍉 大西瓜（专注获得 / 合成获得）
- 👑 金西瓜（专注获得，不可合成）

### 切瓜流程
1. 在瓜棚中选中大西瓜/金西瓜
2. 点击 🔪 切瓜按钮 → 进入全屏切瓜场景
3. 西瓜居中，刀光提示引导滑动方向
4. 用户滑动切开 → 刀光轨迹 + 西瓜裂开 + 汁水粒子飞溅
5. 蹦出神秘种子 + 偶尔蹦出道具
6. 种子和道具自动收入瓜棚

### 切瓜手感
- 音效：清脆的"咔嚓"声 + 汁水飞溅声
- 完美切割（正中间）：额外 +1 种子 + "完美！"特效
- 稀有掉落：慢动作 + 金光 + 专属音效

### 产出规则

| 西瓜类型 | 神秘种子 | 道具 |
|---------|---------|------|
| 🍉 大西瓜 | 1-3 颗 | 偶尔掉落 |
| 👑 金西瓜 | 3-5 颗 | 必出稀有道具 |

### 连切 Combo
- 瓜棚攒了多个大西瓜可连续切
- 连切 3 个 → "切瓜达人！" 最后一个额外奖励
- 连切 5 个 → "瓜神降临！" 必出稀有种子

### 保底机制
- 连续切 30 个瓜没出史诗种子 → 下次必出
- 连续切 80 个瓜没出传说种子 → 下次必出

---

## 四、道具一览

道具在瓜棚存放，**只在农场使用**。

| 道具 | 效果 | 获取方式 |
|------|------|---------|
| ⚡ 星光肥料 | 单株生长时间减半 | 切瓜掉落 |
| ☀️ 超新星能量瓶 | 全农场所有西瓜生长进度加速 50%，持续 24 小时 | 切瓜掉落（稀有） |
| 🛸 外星信号弹 | 向宇宙发射信号，随机召唤一位外星人造访农场（不知道来的是谁！） | 切瓜掉落 |
| 🪤 瓜贼陷阱 | 放在农场，瓜贼来了会被抓住，掉落 2 颗稀有种子 + 1 道具 | 切瓜掉落 |
| 🔮 星际望远镜 | 提前看穿一颗神秘种子的品种，不用种下去就知道是什么 | 切瓜掉落 |
| 🌙 月光露水 | 给一棵西瓜浇上，成熟时品种稀有度 +1 级 | 切瓜掉落（稀有） |
| 🎪 西瓜马戏团帐篷 | 放在农场，所有西瓜今天不会被偷 + 生长速度 +20% | 切瓜掉落 |
| 🧬 基因改造液 | 对一棵正在生长的西瓜使用，30% 概率变异成更高稀有度品种，10% 概率变成跨星系品种 | 切瓜掉落（稀有） |
| 🎵 西瓜摇篮曲唱片 | 放在农场播放，所有西瓜今天生长速度 +30% | 切瓜掉落 |

### 道具风味文案
- ⚡ 星光肥料 — "来自遥远星系的神秘肥料，闻起来像星星的味道"
- ☀️ 超新星能量瓶 — "装着一颗微型超新星的爆发能量"
- 🛸 外星信号弹 — "向宇宙喊一声'这里有瓜！'然后祈祷来的是好人"
- 🪤 瓜贼陷阱 — "看起来像个普通西瓜，其实是个笼子"
- 🔮 星际望远镜 — "据说是外星天文台的遗物"
- 🌙 月光露水 — "只在满月时凝结的神秘露珠"
- 🎪 西瓜马戏团帐篷 — "外星马戏团路过时留下的，西瓜们在里面很开心"
- 🧬 基因改造液 — "变异博士的私人珍藏"
- 🎵 西瓜摇篮曲唱片 — "外星人录制的催眠曲，西瓜听了长得特别快"

---

## 五、瓜棚 UI

### 入口
- 主界面 header 区域 🏠 图标按钮

### 页面布局
- **标题：** 🏠 我的瓜棚 / My Melon Shed
- **收获物区：** 6 种收获物网格（图标 + 名称 + 数量），金西瓜未获得时显示 🔒
- **种子区：** 神秘种子数量 + "去农场种植"入口
- **道具区：** 道具列表 + 数量
- **合成区：** 合成按钮（数量不足时置灰）
- **切瓜区：** 大西瓜/金西瓜列表 + 🔪 切瓜按钮
- **统计：** 总收获数、总切瓜数、最高阶收获物

---

## 六、已实现 vs 待实现

### ✅ 已实现（v0.8.0~v0.9.2）
- 瓜棚页面（收获物展示 + 统计）
- 合成系统（4 条合成链路）
- 金西瓜概率 + 保底机制
- 收获物自动存入瓜棚
- 测试面板

### ⏳ 待实现（v0.17.0）
- 切瓜系统（全屏动画 + 音效 + 手感）
- 神秘种子掉落 + 存储
- 道具掉落 + 存储
- 连切 Combo
- 种子保底机制
- 瓜棚 UI 改版（增加种子区、道具区、切瓜区）
