# 🍉 西瓜时钟 — 版本更新记录

---

## v0.4.2 — 设置菜单显示版本号（2026-02-09）

### 新增
- 设置菜单（齿轮弹窗）最底部显示当前版本号（如 "v0.4.0"）
- 版本号从 package.json 自动读取，Vite define 注入，改一处即可
- 样式低调：小字、浅色，不抢眼
- 中英文界面均正常显示

### 修复
- package.json version 从 0.0.0 更新为 0.4.0

---

## v0.1 — Tauri 桌面应用（2026-02-08）

### 桌面应用
- 通过 Tauri 2.x 将 Web 应用打包为原生桌面应用
- 支持 Windows（.msi + .exe NSIS 安装包）和 Linux（.deb + .AppImage）
- 体积远小于 Electron（Tauri 使用系统 WebView）
- 窗口默认 420×780，可调整大小，最小 360×600
- 系统托盘支持（托盘图标 + tooltip）
- 桌面端功能与 Web 端完全一致

### 自动构建 & 发布
- GitHub Actions 矩阵构建：Windows + Linux 同时构建
- 推送 `v*` tag 或手动触发自动构建
- 构建产物自动发布到 GitHub Releases
- Rust 编译缓存加速后续构建

### Release 优化
- LTO（Link-Time Optimization）减小二进制体积
- 代码剥离（strip）移除调试符号
- 单 codegen unit 最大化优化效果

---

## v0.4.1 — UI 视觉升级（2026-02-09）

### 质感提升
- 进度环更精致：环宽 10→8，加外发光效果，底环透明度降低
- 计时数字悬浮感：字重 300→200，加微妙 text-shadow
- ✗/✓ 按钮改为 SVG 图标（交叉线 / 勾号，圆角端点）
- 任务输入框：背景色提升 + 1px 边框 + 聚焦态主题色边框 + placeholder 颜色提升
- Header 毛玻璃效果：backdrop-blur + sticky 定位 + 底部分割线
- 统计区域卡片化：surface 背景 + 圆角 + 微妙边框

### 氛围感
- 背景微妙渐变（顶部→底部稍亮 2-3%）
- 阶段切换过渡放慢至 1.5s
- 西瓜图标 idle 时呼吸动画（3s 循环）

### 品牌感
- Logo 绿色光晕（drop-shadow）
- dark 主题色调整：番茄红→西瓜红（rose-500 #f43f5e）

---

## v0.4 — 番茄钟与项目模式交互重构（2026-02-09）

### 番茄钟简化
- **去掉长休息/轮次系统**：纯"专注→休息"无限循环
- **去掉轮次指示器**（圆点进度）
- **退出需确认**：弹窗确认后记录标记为未完成
- **任务名称可选**：不输入自动生成"专注 #N"（今天第几个）
- 设置面板精简：删除长休息时长、长休息间隔

### 项目模式退出重构
- **两步退出流程**：确认退出 → 选择下一步
  - 🔄 重新开始本任务
  - ⏭️ 下一个任务（最后一个→结束项目）
  - ⏮️ 返回上一个任务（超时继续）
- **退出整个项目**选项
- 退出的任务标记为"已退出"

### 记录系统增强
- `PomodoroRecord` 新增 `status` 字段（completed/abandoned）
- `ProjectTaskResult` 新增 abandoned/overtime-continued 状态
- 历史记录显示任务名称和状态

---

## v0.3.1 — 项目模式交互优化（2026-02-08）

### 超时行为简化
- **超时默认继续计时**：子任务超时后不再弹出提示，默认继续计时
- 进度环变红 + 数字变红显示 "+MM:SS" 保留，用户可感知超时状态

### 统一按钮布局
- **番茄钟和项目模式完全一致**：✗（左）⏸/▶（中）✓（右）
- ✗ 按钮：番茄钟放弃本次 / 项目跳过子任务
- ✓ 按钮：番茄钟手动完成 / 项目完成子任务
- 休息阶段自动隐藏 ✗/✓，只保留暂停/继续
- 删除底部"放弃本次"文字按钮

### Bug 修复
- **修复完成子任务后白屏**：break 阶段误触 ✓/✗ 导致状态越界崩溃，现已加 phase 保护

---

## v0.3 — 项目计时模式（2026-02-08）

### 新功能：项目模式
- **创建项目**：输入项目名称，添加多个子任务
- **子任务设置**：每个子任务可设定名称、预计时间、休息时间
- **自动推进**：子任务按顺序执行，中间自动插入休息
- **复用番茄钟界面**：计时环节使用相同的进度环、西瓜生长、背景音，上方增加任务信息条
- **超时处理**：超时后默认继续计时，进度环变红 + 数字显示 "+MM:SS"
- **超时视觉反馈**：进度环变红脉冲 + 计时数字变红显示 "+MM:SS"
- **✓/✗ 按钮**：完成或跳过当前子任务，操作更直观
- **中途调整**：执行中可插入新任务、删除未来任务
- **完成总结**：预计 vs 实际时间对比，每个子任务时间条形图
- **中断恢复**：关闭浏览器后重新打开，可恢复未完成项目
- **历史记录**：项目记录保存到历史面板，按日期查看
- **西瓜生长**：子任务完成按实际时长计入西瓜生长系统

### UI
- 首页新增模式切换：🍉 番茄钟 / 📋 项目模式
- 计时中模式切换锁定，防止误操作
- 项目工作阶段播放背景音

---

## v0.2.4 — 背景音即时生效 + 新时钟音效（2026-02-08）

### Bug 修复
- **专注中修改背景音即时生效**：在专注计时过程中打开混音器修改背景音，关闭弹窗后新的背景音立即播放，无需暂停再继续

### 新增 4 种时钟音效（共 8 种）
- 🕰️ 老式座钟 — 低沉有共鸣的深沉滴答
- ⌚ 怀表 — 清脆细腻的快速 tick-tock
- 🎵 电子节拍器 — 干净的电子点击，4 拍重音
- 💧 水滴计时 — 水滴音色 + 涟漪回响

---

## v0.2.3 — 体验修复 + 新背景音（2026-02-08）

### Bug 修复
- Header 显示实际产品 Logo（替换 emoji）
- 设置面板不再因点击弹窗内部而误关闭
- 时钟滴答声音量提升 3-4 倍
- 咖啡厅音效完全重做（更真实的多层环境音）

### 新增 6 种背景音（总计 25 种）
- 🏕️ 篝火 — 温暖的噼啪声 + 偶尔木头爆裂
- 🎹 轻音乐 — 柔和的随机钢琴音符
- 🐱 猫咪呼噜 — 低频呼噜声，有呼吸节奏
- 🌙 夜晚 — 轻风 + 远处蟋蟀 + 偶尔猫头鹰
- 🚂 火车 — 铁轨节奏咔嗒声 + 车轮轰鸣
- 🫧 水下 — 深沉水声 + 气泡上浮

---

## v0.2.2 — Logo 全站替换（2026-02-08）

- 新 logo 替换到所有位置：favicon、PWA、Tauri 桌面端、apple-touch-icon
- 多尺寸 favicon（16/32/48 + .ico）
- SVG 版本
- 图标生成脚本 `scripts/generate-icons.mjs`

---

## v0.2.1 — 音效修复（2026-02-08）

### Bug 修复
- 修复"自动开始休息"失效问题
- 混音器 Modal 支持实时预览（不需要在专注时间才能听到）

### 音效改善
- 雨声更有层次感（3 层混合 + 强度变化）
- 雷雨新增闪电劈裂声 + 深沉雷鸣
- 虫鸣完全重写（多只蟋蟀此起彼伏）
- 鸟鸣优化（多音符乐句 + 立体声）

### 保留原有滴答声
- 经典钟摆、轻柔滴答、机械钟表、木质钟声回归
- 作为混音器「🕐 时钟」分类，可与其他背景音叠加
- 背景音总数：19 种

---

## v0.2 — 音效系统大改版（2026-02-08）

### 自定义背景音混音器
- 全新混音面板：弹窗式 UI，列出所有可用背景音
- **15 种背景音**，全部 Web Audio API 实时合成，零音频文件：
  - 🌧️ 自然类（7 种）：雨声、雷雨、海浪、溪流、鸟鸣、风声、虫鸣
  - 🏠 环境类（4 种）：咖啡厅、壁炉、键盘敲击、图书馆
  - 🎵 噪音类（4 种）：白噪音、粉噪音、棕噪音、双耳节拍
- 每个音效独立开关 + 独立音量滑块
- 支持多音效同时叠加组合（如"雨声 + 壁炉 + 棕噪音"）
- 设置面板显示当前组合预览 + 「自定义」按钮
- 总音量由"背景音量"滑块统一控制
- 组合配置持久化到 localStorage

### 提醒音效升级
- **10 种提醒音效**：和弦、铃声、自然、木琴、钢琴、电子、水滴、鸟鸣、马林巴、锣声
- 全部 Web Audio API 合成，弹窗选择 + 点击试听
- "提醒时长"改为"循环次数"（1/2/3/5 次），音效按次数循环播放

### 技术亮点
- 全新 `src/audio/` 模块化音频引擎，替代旧 `notification.ts`
- OOP 设计：每种背景音一个 AmbienceSound 子类
- 旧版设置自动迁移，向后兼容
- 构建产物仅增加 ~24KB（gzip ~5KB），零音频文件
- 中英文翻译完整覆盖所有新增文案

---

## v0.05 — 多语言支持（2026-02-08）

### 中英文双语
- 支持中文（默认）和英文两种语言
- 自动检测浏览器语言，匹配不到默认中文
- 用户可在设置面板手动切换（中文 / EN）
- 语言选择持久化到 localStorage，切换无需刷新页面

### 全量文案覆盖
- 标题、按钮、设置面板所有选项标签
- 统计面板（连续打卡、趋势图表、汇总卡片）
- 历史记录面板（日期、记录详情）
- 使用说明弹窗、庆祝文字、新手引导
- PWA 安装提示、日历星期/月份、图表标签
- 页面标题（document.title）跟随语言切换

### 技术方案
- 自建轻量 i18n 系统：React Context + `useI18n` hook，零第三方依赖
- `Messages` 类型接口保证编译时翻译完整性
- 支持函数类型翻译（动态参数：时间格式化、连续天数等）
- 扩展新语言只需新建 locale 文件 + 注册

---

## v0.04 — 品牌升级 + 历史统计（2026-02-08）

### 品牌升级：番茄 → 西瓜
- 全部 UI 文案从"番茄"更名为"西瓜"
- PWA 应用名称、页面标题、meta 标签同步更新
- 使用说明注明"基于番茄工作法（Pomodoro Technique）"
- App 图标重新设计为切开的西瓜 + 时钟指针

### 自定义 SVG 西瓜生长图标
替换所有 emoji，改为 5 个手绘 SVG 图标：
- 种子发芽（<10min）— 黑色西瓜籽冒出小绿芽
- 幼苗生长（10-14min）— 绿苗 + 叶子 + 西瓜藤卷须
- 开花期（15-19min）— 藤蔓上开出黄色小花
- 小西瓜（20-24min）— 浅绿/黄绿色未成熟小西瓜
- 成熟西瓜（≥25min）— 切开露出红瓤 + 黑籽

### 历史记录
- 新增 📅 按钮，打开底部滑入面板
- 月历视图：可翻月浏览，有记录的日期显示圆点标记
- 点击任意日期查看当天的完整记录（任务、时长、生长图标、完成时间）

### 统计图表
- 纯 SVG 柱状图：最近 7 天 / 30 天专注时长趋势
- 柱子带入场动画，今天高亮显示
- 汇总卡片：本周时长、本月时长、累计总时长、累计完成数量
- 图表配色跟随当前主题，无第三方图表库

### 连续打卡
- 全自动：当天完成 ≥1 个西瓜钟即视为打卡
- 主页 Header 显示 🔥 当前连续天数
- 统计面板展示当前连续天数 + 历史最长连续天数

---

## v0.03 — 体验完善（2026-02-08）

### 自定义时长 & 长休息
- 专注时长 1-120 分钟可调
- 短休息 1-30 分钟、长休息 1-60 分钟
- 每 2-6 轮触发一次长休息

### 音效系统
- 3 种提醒音效：和弦、铃声、自然
- 5 种专注背景音：经典钟摆、轻柔滴答、机械钟表、木质钟声
- 提醒时长可调（1/3/5/10 秒）
- 提醒音量和背景音量独立控制

### 主题系统
- 5 套主题：经典暗色、纯净亮色、森林绿、海洋蓝、暖橙色
- 工作/休息阶段背景色、进度环、按钮颜色全部跟随主题

### 生长阶段系统
- 根据专注时长显示不同生长阶段（5 级）
- 今日收获区域展示所有完成的生长图标

### 庆祝动画
- 完成西瓜钟时：弹跳图标 + 粒子纸屑 + 进度环脉冲 + 鼓励文字
- ≥25 分钟的庆祝效果更强烈

### 休息视觉差异
- 工作阶段偏暖色调，休息阶段偏冷色调
- 标题、进度环、按钮、背景色全部跟随阶段切换
- 平滑 transition 过渡动画

### PWA 支持
- 可安装到手机/电脑桌面，standalone 模式运行
- Service Worker 离线缓存（静态资源 + Google Fonts）
- iOS Safari "添加到主屏幕"支持
- 友好的安装提示横幅（关闭后不再弹出）

### 操作改进
- 放弃按钮：计时中可放弃本次，不计入记录
- 手动完成：跳过时按实际专注时间记录
- 删除确认：inline "确认?" 提示，防止误删
- 自动开始休息（默认开）/ 自动开始工作（默认关）
- 快速调时间：idle 时点击数字弹出时长选择器
- 导出数据：JSON 文件包含所有记录 + 设置
- 新手引导弹窗

### Bug 修复
- 暂停后可调时间 → running + paused 都锁定设置
- 小屏幕设置按钮被挤 → Header 响应式优化
- PWA 打开自动弹键盘 → 移除 autofocus

---

## v0.02 — 视觉升级（2026-02-08）

### 全面 UI 重设计
- 现代极简风格，深色背景
- 渐变进度环 + 发光头部圆点
- 内发光效果 + 径向渐变
- 经过多轮迭代调整亮度、光晕、对比度

---

## v0.01 — MVP（2026-02-08）

### 核心功能
- 番茄工作法计时：25 分钟专注 + 5 分钟休息
- 圆形进度环 SVG 计时器
- 任务输入框：为每个番茄钟标记任务
- 今日完成统计
- 任务记录列表
- 浏览器通知 + 音效提醒
- localStorage 本地存储
- 响应式布局

### 技术栈
- React 19 + TypeScript
- Vite 7
- Tailwind CSS 4
